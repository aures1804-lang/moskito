Carpeta Backend\app

--init__.py
from flask import Flask
from flask_sqlalchemy import SQLAlchemy

db = SQLAlchemy()

def create_app():
    app = Flask(__name__)
    # Configuraci√≥n se mover√° aqu√≠ en el futuro, pero por ahora se maneja en run.py
    db.init_app(app)
    return app



models.py
from . import db  # Import relativo desde el paquete app
from datetime import datetime

class Caso(db.Model):
    __tablename__ = 'casos'
   
    id = db.Column(db.Integer, primary_key=True)
    sintomas = db.Column(db.JSON)
    probabilidades = db.Column(db.JSON)
    lat = db.Column(db.Float, nullable=False)
    lon = db.Column(db.Float, nullable=False)
    timestamp = db.Column(db.DateTime, default=datetime.utcnow, nullable=False)
   
    municipio = db.Column(db.String(100))
    barrio = db.Column(db.String(100))
    edad = db.Column(db.Integer)
    genero = db.Column(db.String(10))
    estado = db.Column(db.String(20), default='pendiente')
   
    def __repr__(self):
        return f'<Caso {self.id} - {self.timestamp}>'
   
    def to_dict(self):
        return {
            'id': self.id,
            'sintomas': self.sintomas,
            'probabilidades': self.probabilidades,
            'lat': self.lat,
            'lon': self.lon,
            'timestamp': self.timestamp.isoformat() if self.timestamp else None,
            'municipio': self.municipio,
            'barrio': self.barrio,
            'edad': self.edad,
            'genero': self.genero,
            'estado': self.estado
        }
    
    
routes.py
from flask import Blueprint, jsonify, request
from . import db
from .models import Caso
from .utils.scoring import calcular_probabilidades
from datetime import datetime

api = Blueprint('api', __name__)

# Ruta para evaluar s√≠ntomas (core: identificaci√≥n de enfermedades)
@api.route('/evaluar-sintomas', methods=['POST'])
def evaluar_sintomas():
    data = request.json
    sintomas = data.get('sintomas', [])
    probabilidades = calcular_probabilidades(sintomas)
    if not probabilidades:
        return jsonify({'mensaje': 'Baja probabilidad de enfermedades vectoriales. Monitorea tus s√≠ntomas.', 'advertencia': 'Esto es una estimaci√≥n; consulta un m√©dico.'})
    return jsonify({'probabilidades': probabilidades, 'advertencia': 'Esto es una estimaci√≥n; consulta un m√©dico.'})

# Resto de sus rutas (home, health, get_casos, etc.) adaptadas a Blueprint con @api.route en lugar de @app.route
@api.route('/')
def home():
    return jsonify({
        "message": "ü¶ü API Moskito - Sistema de Vigilancia Epidemiol√≥gica",
        "status": "online",
        "version": "1.0",
        "endpoints": {
            "health": "/api/health",
            "docs": "/api/docs",
            "casos": "/api/casos"
        }
    })

# ... (incluya todas las otras rutas como @api.route('/health'), etc., sin cambiar su l√≥gica)

# Manejo de errores se mueve a run.py o se registra en el app principal

scoring.py

ENFERMEDADES = {
    'dengue': {'fiebre_alta': 2, 'dolor_cabeza': 1, 'erupciones': 2, 'dolor_muscular': 2, 'nauseas': 1},
    'zika': {'fiebre_baja': 2, 'erupciones': 3, 'conjuntivitis': 2, 'dolor_articular': 1},
    'chikungunya': {'fiebre_alta': 1, 'dolor_articular': 3, 'erupciones': 1, 'fatiga': 2},
    'malaria': {'fiebre_ciclica': 3, 'escalofrios': 2, 'sudoracion': 2, 'fatiga': 1},
    'fiebre_amarilla': {'fiebre_alta': 2, 'ictericia': 3, 'dolor_abdominal': 2, 'vomitos': 2, 'sangrado': 3}
}
MAX_PUNTOS = {enf: sum(pesos.values()) for enf, pesos in ENFERMEDADES.items()}

def calcular_probabilidades(sintomas):
    probabilidades = {}
    for enf, pesos in ENFERMEDADES.items():
        puntos = sum(pesos.get(sint, 0) for sint in sintomas)
        prob = (puntos / MAX_PUNTOS[enf]) * 100 if MAX_PUNTOS[enf] > 0 else 0
        if prob > 0:
            probabilidades[enf] = round(prob, 2)
    return probabilidades


.env

DATABASE_URL=postgresql://vigilancia_user:Alfa$1234@localhost:5432/vigilancia_db
SQLALCHEMY_DATABASE_URI=postgresql://vigilancia_user:Alfa$1234@localhost:5432/vigilancia_db
SECRET_KEY=Alfa$1234

run.py

from flask import Flask
from dotenv import load_dotenv
import os
import sys

print("=" * 50)
print("DIAGN√ìSTICO DE VARIABLES DE ENTORNO")
print("=" * 50)
# Mostrar el directorio actual
current_dir = os.path.dirname(os.path.abspath(__file__))
print(f"Directorio actual: {current_dir}")
# Buscar el archivo .env
env_path = os.path.join(current_dir, '.env')
print(f"Buscando .env en: {env_path}")
print(f"¬øExiste el archivo?: {os.path.exists(env_path)}")
if os.path.exists(env_path):
    # Mostrar contenido del .env (sin contrase√±as)
    print("\nContenido del archivo .env:")
    with open(env_path, 'r') as f:
        for line in f:
            if line.strip() and not line.startswith('#'):
                key = line.split('=')[0]
                print(f" - {key}")
   
    # Cargar el archivo .env
    load_dotenv(dotenv_path=env_path)
    print("\n‚úì Archivo .env cargado")
else:
    print("\n‚úó ERROR: Archivo .env NO encontrado")
    print("Crea un archivo .env en:", current_dir)
    sys.exit(1)
# Verificar variables despu√©s de cargar
print("\nVariables cargadas:")
database_url = os.getenv('DATABASE_URL') or os.getenv('SQLALCHEMY_DATABASE_URI')
secret_key = os.getenv('SECRET_KEY')
print(f"DATABASE_URL: {database_url[:30] + '...' if database_url else 'NO CARGADA'}")
print(f"SECRET_KEY: {secret_key if secret_key else 'NO CARGADA'}")
print("=" * 50)
if not database_url:
    print("\n‚úó ERROR: No se pudo cargar DATABASE_URL o SQLALCHEMY_DATABASE_URI")
    print("\nAseg√∫rate de que tu archivo .env contenga:")
    print("DATABASE_URL=postgresql://usuario:contrase√±a@localhost:5432/nombre_db")
    print("SECRET_KEY=tu_clave_secreta")
    sys.exit(1)

# Crear aplicaci√≥n Flask
app = Flask(__name__)
# Configuraci√≥n
app.config['SQLALCHEMY_DATABASE_URI'] = database_url
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False
app.secret_key = secret_key

# Inicializar SQLAlchemy (despu√©s de config)
from flask_sqlalchemy import SQLAlchemy
db = SQLAlchemy(app)

# Registrar blueprint de rutas (despu√©s de db)
from app.routes import api
app.register_blueprint(api)

# Importar modelos (despu√©s de db para evitar ciclos)
try:
    from app.models import *
    print("‚úì Modelos importados correctamente")
except ImportError as e:
    print(f"‚ö† Advertencia: No se pudieron importar modelos - {e}")

if __name__ == '__main__':
    # Crear todas las tablas
    with app.app_context():
        try:
            db.create_all()
            print("=" * 50)
            print("‚úì Tablas creadas exitosamente")
            print("=" * 50)
        except Exception as e:
            print("=" * 50)
            print(f"‚úó Error al crear tablas: {e}")
            print("=" * 50)
   
    # Iniciar servidor
    print("\nüöÄ Servidor Flask iniciando en http://127.0.0.1:5000")
    print("Presiona CTRL+C para detener\n")
    app.run(debug=True, host='0.0.0.0', port=5000)
    

frontend

index.html

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Sistema de Vigilancia Epidemiol√≥gica Comunitaria" />
    <title>Moskito - Vigilancia Epidemiol√≥gica</title>
  </head>
  <body>
    <noscript>Necesitas habilitar JavaScript para ejecutar esta app.</noscript>
    <div id="root"></div>
  </body>
</html>



SintomasForm.js

import React, { useState } from 'react';
import axios from 'axios';
import { Button, Form, Card, Alert, Spinner } from 'react-bootstrap';

const SintomasForm = () => {
  const [sintomas, setSintomas] = useState([]);
  const [resultado, setResultado] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const listaSintomas = [
    { value: 'fiebre_alta', label: 'Fiebre alta (>38¬∞C)' },
    { value: 'fiebre_baja', label: 'Fiebre baja' },
    { value: 'fiebre_ciclica', label: 'Fiebre c√≠clica' },
    { value: 'dolor_cabeza', label: 'Dolor de cabeza intenso' },
    { value: 'dolor_muscular', label: 'Dolor muscular' },
    { value: 'dolor_articular', label: 'Dolor articular' },
    { value: 'dolor_abdominal', label: 'Dolor abdominal' },
    { value: 'erupciones', label: 'Erupciones en la piel' },
    { value: 'conjuntivitis', label: 'Conjuntivitis (ojos rojos)' },
    { value: 'nauseas', label: 'N√°useas' },
    { value: 'vomitos', label: 'V√≥mitos' },
    { value: 'fatiga', label: 'Fatiga extrema' },
    { value: 'escalofrios', label: 'Escalofr√≠os' },
    { value: 'sudoracion', label: 'Sudoraci√≥n excesiva' },
    { value: 'ictericia', label: 'Ictericia (piel/ojos amarillos)' },
    { value: 'sangrado', label: 'Sangrado inusual' }
  ];

  const handleCheckbox = (e) => {
    const value = e.target.value;
    setSintomas(prev => 
      e.target.checked ? [...prev, value] : prev.filter(s => s !== value)
    );
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError(null);
    setResultado(null);

    if (sintomas.length === 0) {
      setError('Por favor selecciona al menos un s√≠ntoma');
      setLoading(false);
      return;
    }

    try {
      const res = await axios.post('http://localhost:5000/evaluar-sintomas', { 
        sintomas 
      });
      setResultado(res.data);
    } catch (error) {
      console.error('Error al evaluar s√≠ntomas:', error);
      setError('Error al conectar con el servidor. Verifica que el backend est√© corriendo en el puerto 5000.');
    } finally {
      setLoading(false);
    }
  };

  const handleRegistrar = async () => {
    if (!navigator.geolocation) {
      alert('Tu navegador no soporta geolocalizaci√≥n');
      return;
    }

    navigator.geolocation.getCurrentPosition(
      async (pos) => {
        try {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          
          await axios.post('http://localhost:5000/api/casos', {
            sintomas,
            probabilidades: resultado.probabilidades,
            lat,
            lon,
            municipio: 'Buenaventura',
            estado: 'pendiente'
          });
          
          alert('‚úÖ Caso registrado exitosamente');
          setSintomas([]);
          setResultado(null);
          document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        } catch (error) {
          console.error('Error al registrar caso:', error);
          alert('‚ùå Error al registrar el caso');
        }
      },
      (error) => {
        console.error('Error de geolocalizaci√≥n:', error);
        alert('‚ö†Ô∏è No se pudo obtener tu ubicaci√≥n. Por favor habilita los permisos de ubicaci√≥n.');
      }
    );
  };

  return (
    <Card className="shadow-lg">
      <Card.Body className="p-4">
        <Card.Title className="text-center mb-4">
          <h3>üìã Evaluaci√≥n de S√≠ntomas</h3>
          <p className="text-muted small">Selecciona los s√≠ntomas que presentas actualmente</p>
        </Card.Title>

        <Form onSubmit={handleSubmit}>
          <div className="row">
            {listaSintomas.map((sintoma, index) => (
              <div key={index} className="col-md-6 mb-2">
                <Form.Check
                  type="checkbox"
                  label={sintoma.label}
                  value={sintoma.value}
                  onChange={handleCheckbox}
                  id={`sintoma-${index}`}
                />
              </div>
            ))}
          </div>

          <div className="text-center mt-4">
            <Button 
              type="submit" 
              variant="primary" 
              size="lg"
              disabled={loading || sintomas.length === 0}
            >
              {loading ? (
                <>
                  <Spinner animation="border" size="sm" className="me-2" />
                  Evaluando...
                </>
              ) : (
                'üîç Evaluar S√≠ntomas'
              )}
            </Button>
          </div>
        </Form>

        {error && (
          <Alert variant="danger" className="mt-4">
            {error}
          </Alert>
        )}

        {resultado && (
          <Card className="mt-4 border-primary">
            <Card.Body>
              <h5 className="text-primary mb-3">üìä Resultados de la Evaluaci√≥n</h5>
              
              {resultado.probabilidades ? (
                <>
                  <div className="mb-3">
                    <strong>Probabilidades estimadas:</strong>
                    {Object.entries(resultado.probabilidades).map(([enfermedad, prob]) => (
                      <div key={enfermedad} className="mt-2">
                        <div className="d-flex justify-content-between align-items-center">
                          <span className="text-capitalize">{enfermedad.replace('_', ' ')}</span>
                          <span className="badge bg-primary">{prob.toFixed(1)}%</span>
                        </div>
                        <div className="progress mt-1" style={{ height: '8px' }}>
                          <div 
                            className="progress-bar bg-primary" 
                            style={{ width: `${prob}%` }}
                          ></div>
                        </div>
                      </div>
                    ))}
                  </div>
                  
                  <Alert variant="warning" className="mb-3">
                    <small>
                      ‚ö†Ô∏è {resultado.advertencia || 'Esta es una estimaci√≥n preliminar. Consulta a un profesional de salud para un diagn√≥stico preciso.'}
                    </small>
                  </Alert>

                  <div className="text-center">
                    <Button 
                      variant="success" 
                      size="lg"
                      onClick={handleRegistrar}
                    >
                      üìç Registrar Caso con Ubicaci√≥n
                    </Button>
                  </div>
                </>
              ) : (
                <Alert variant="info">
                  {resultado.mensaje || 'Baja probabilidad de enfermedades vectoriales. Monitorea tus s√≠ntomas.'}
                </Alert>
              )}
            </Card.Body>
          </Card>
        )}
      </Card.Body>
    </Card>
  );
};

export default SintomasForm;

App.css

.App {
  min-height: 100vh;
  padding: 20px;
}

.card {
  box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  border: none;
  border-radius: 15px;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border: none;
  padding: 12px 30px;
  border-radius: 25px;
  font-weight: bold;
  transition: transform 0.2s;
}

.btn-primary:hover {
  transform: scale(1.05);
}

.btn-success {
  background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  border: none;
  padding: 12px 30px;
  border-radius: 25px;
  font-weight: bold;
}


App.js

import './App.css';
import 'bootstrap/dist/css/bootstrap.min.css';
import SintomasForm from './components/SintomasForm';

function App() {
  return (
    <div className="App">
      <div className="container py-5">
        <header className="text-center mb-5">
          <h1 className="display-4 text-white mb-3">
            ü¶ü Sistema de Vigilancia Epidemiol√≥gica
          </h1>
          <p className="lead text-white-50">
            Evaluaci√≥n de s√≠ntomas para enfermedades vectoriales
          </p>
        </header>
        <div className="row justify-content-center">
          <div className="col-md-10 col-lg-8">
            <SintomasForm />
          </div>
        </div>
      </div>
    </div>
  );
}

export default App;


index.css

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}


index.js

import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import App from './App';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);


package.json

{
  "name": "frontend",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@testing-library/jest-dom": "^5.17.0",
    "@testing-library/react": "^13.4.0",
    "@testing-library/user-event": "^13.5.0",
    "ajv": "^8.17.1",
    "axios": "^1.7.7",
    "bootstrap": "^5.3.3",
    "react": "^18.3.1",
    "react-bootstrap": "^2.10.5",
    "react-dom": "^18.3.1",
    "react-scripts": "5.0.1",
    "web-vitals": "^2.1.4"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  },
  "proxy": "http://localhost:5000"
}



